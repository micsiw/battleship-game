(()=>{"use strict";const e=e=>({name:e,turn:!1,ships:["Destroyer","Destroyer","Submarine","Cruiser","Battleship","Carrier"]}),c=e=>{let c=e,o=!1;return{getHealth:()=>c,getSize:()=>e,hit:()=>{c-=1},isSunk:()=>(o=c<1,o)}},o={Carrier:c(5),Battleship:c(4),Cruiser:c(3),Submarine:c(3),Destroyer:c(2)},t=100,i=()=>{const e=[];return function(c){for(let o=0;o<c;o++){const c={occupied:null,visited:!1};e.push(c)}}(t),{board:e,placeShip:(c,i,l=function(){return Math.random()<.5}())=>{const r=o[c],d=r.getSize(),u=l,n=[0,10,20,30,40,50,60,70,80,90,100],s=[100,101,102,103,104,105,106,107,108,109];function a(){if(!0===u){for(let e=1;e<d;e++)if(n.includes(i+e))return!1;for(let c=0;c<d;c++)if(i+c>=0&&i+c<t&&null!==e[i+c].occupied)return!1}else if(!1===u){let c=0;for(let e=0;e<d;e++){if(s.includes(i+c))return!1;c+=10}c=0;for(let o=0;o<d;o++)if(i+c>=0&&i+c<t){if(null!==e[i+c].occupied)return!1;c+=10}}return!0}if(!0===u&&!0===a()){[i+d-10,i+d+10,i+d,i-11,i-1,i+9].forEach(((c,o)=>{c>=0&&c<100&&(o<3&&!n.includes(c)&&(e[c].occupied="blocked"),o>2&&!n.map((e=>e-1)).includes(c)&&(e[c].occupied="blocked"))}));for(let c=0;c<d;c++){const o=[i+c+10,i+c-10];e[i+c].occupied=r,o.forEach((c=>{c>=0&&c<100&&(e[c].occupied="blocked")}))}return!0}if(!1===u&&!0===a()){[i-9,i+10*d+1,i-11,i+10*d-1,i-10,i+10*d].forEach(((c,o)=>{c>=0&&c<100&&(o<2&&!n.includes(c)&&(e[c].occupied="blocked"),o>1&&o<4&&!n.map((e=>e-1)).includes(c)&&(e[c].occupied="blocked"),o>3&&(e[c].occupied="blocked"))}));let c=0;for(let o=0;o<d;o++){const o=[i+c+1,i+c-1];e[i+c].occupied=r,o.forEach(((c,o)=>{c>=0&&c<100&&(0!==o||n.includes(c)||(e[c].occupied="blocked"),1!==o||n.map((e=>e-1)).includes(c)||(e[c].occupied="blocked"))})),c+=10}return!0}return!1},receiveAttack:c=>{!0===e[c].visited?console.log("Field was already used"):null!==e[c].occupied&&"blocked"!==e[c].occupied?(console.log("Ship was striked"),e[c].occupied.hit(),e[c].visited=!0):e[c].visited=!0},areAllSunk:()=>{let c=!0;return e.forEach((e=>{null!==e.occupied&&"blocked"!==e.occupied&&!1===e.occupied.isSunk()&&(c=!1)})),c}}},l=e("Player"),r=e("Computer"),d=i(),u=i(),n=document.querySelector(".gameboards");function s(e,c){const o=e.ships,i=e.ships.length;for(let e=0;e<i;e++){const i=o.pop(),l=Math.floor(Math.random()*t);!1===c.placeShip(i,l)&&(o.push(i),e-=1)}}function a(){p(d,l),p(u,r),document.querySelector("[data-player='Computer'").childNodes.forEach((e=>{e.addEventListener("click",(()=>{var c;c=e.dataset.field,u.receiveAttack(c),n.innerHTML="",a(),console.log(e.dataset.field)}))}))}function p(e,c){const o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns=`repeat(${Math.sqrt(t)}, 1fr)`,o.dataset.player=c.name,e.board.forEach(((e,c)=>{const t=document.createElement("div");t.classList.add("field"),t.dataset.field=c,null===e.occupied&&!0===e.visited||"blocked"===e.occupied&&!0===e.visited?t.style.backgroundColor="lightgray":null!==e.occupied&&!0===e.visited||"blocked"!==e.occupied&&!0===e.visited?t.style.backgroundColor="red":null!==e.occupied&&"blocked"!==e.occupied&&(t.style.backgroundColor="yellow"),o.appendChild(t)})),n.appendChild(o)}s(l,d),s(r,u),a()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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M0JnQyxFQUFjUCxjQUFjbEIsR0FNNUIwQixFQUFlaUIsVUFBWSxHQUozQkwsSUFuQkluQixRQUFRQyxJQUFJM0IsRUFBTWlELFFBQVFqRCxNQUFNLEdBQ2hDLEdBUU4sQ0FpQkEsU0FBUzhDLEVBQWNqRCxFQUFPd0MsR0FDNUIsTUFBTWMsRUFBV2pCLFNBQVNrQixjQUFjLE9BRXhDRCxFQUFTRSxNQUFNQyxRQUFVLE9BQ3pCSCxFQUFTRSxNQUFNRSxvQkFBc0IsVUFBVTlDLEtBQUsrQyxLQUFLdkUsV0FDekRrRSxFQUFTRixRQUFRWixPQUFTQSxFQUFPdkQsS0FFakNlLEVBQU1BLE1BQU11QixTQUFRLENBQUNwQixFQUFPcUIsS0FDMUIsTUFBTW9DLEVBQVl2QixTQUFTa0IsY0FBYyxPQUN6Q0ssRUFBVUMsVUFBVUMsSUFBSSxTQUN4QkYsRUFBVVIsUUFBUWpELE1BQVFxQixFQUVKLE9BQW5CckIsRUFBTUMsV0FBdUMsSUFBbEJELEVBQU1FLFNBQ2QsWUFBbkJGLEVBQU1DLFdBQTRDLElBQWxCRCxFQUFNRSxRQUV2Q3VELEVBQVVKLE1BQU1PLGdCQUFrQixZQUVkLE9BQW5CNUQsRUFBTUMsV0FBdUMsSUFBbEJELEVBQU1FLFNBQ2QsWUFBbkJGLEVBQU1DLFdBQTRDLElBQWxCRCxFQUFNRSxRQUV2Q3VELEVBQVVKLE1BQU1PLGdCQUFrQixNQUNOLE9BQW5CNUQsRUFBTUMsVUFBd0MsWUFBbkJELEVBQU1DLFdBQzFDd0QsRUFBVUosTUFBTU8sZ0JBQWtCLFVBR3BDVCxFQUFTVSxZQUFZSixFQUFVLElBR2pDeEIsRUFBZTRCLFlBQVlWLEVBQzdCLENBM0NFZixFQUFtQixFQUFRTCxHQUMzQkssRUFBbUJOLEVBQVVFLEdDekMvQmEsRyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAtZ2FtZS8uL3NyYy9tb2R1bGVzL3BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLWdhbWUvLi9zcmMvbW9kdWxlcy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAtZ2FtZS8uL3NyYy9tb2R1bGVzL3NoaXBUeXBlcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLWdhbWUvLi9zcmMvbW9kdWxlcy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC1nYW1lLy4vc3JjL21vZHVsZXMvaW50ZXJmYWNlLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAtZ2FtZS8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBQbGF5ZXIgPSAobmFtZSkgPT4ge1xuICBjb25zdCB0dXJuID0gZmFsc2U7XG4gIGNvbnN0IHNoaXBzID0gW1xuICAgIFwiRGVzdHJveWVyXCIsXG4gICAgXCJEZXN0cm95ZXJcIixcbiAgICBcIlN1Ym1hcmluZVwiLFxuICAgIFwiQ3J1aXNlclwiLFxuICAgIFwiQmF0dGxlc2hpcFwiLFxuICAgIFwiQ2FycmllclwiLFxuICBdO1xuXG4gIHJldHVybiB7IG5hbWUsIHR1cm4sIHNoaXBzIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXI7XG4iLCJjb25zdCBTaGlwID0gKHNpemUpID0+IHtcbiAgbGV0IGhlYWx0aCA9IHNpemU7XG4gIGxldCBzdW5rID0gZmFsc2U7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhlYWx0aCAtPSAxO1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICBpZiAoaGVhbHRoIDwgMSkge1xuICAgICAgc3VuayA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN1bmsgPSBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHN1bms7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRIZWFsdGg6ICgpID0+IGhlYWx0aCxcbiAgICBnZXRTaXplOiAoKSA9PiBzaXplLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTaGlwO1xuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vc2hpcFwiO1xuXG5jb25zdCB0eXBlcyA9IHtcbiAgQ2FycmllcjogU2hpcCg1KSxcbiAgQmF0dGxlc2hpcDogU2hpcCg0KSxcbiAgQ3J1aXNlcjogU2hpcCgzKSxcbiAgU3VibWFyaW5lOiBTaGlwKDMpLFxuICBEZXN0cm95ZXI6IFNoaXAoMiksXG59O1xuXG5leHBvcnQgZGVmYXVsdCB0eXBlcztcbiIsImltcG9ydCB0eXBlcyBmcm9tIFwiLi9zaGlwVHlwZXNcIjtcblxuY29uc3Qgc2l6ZSA9IDEwMDtcblxuZnVuY3Rpb24gZ2V0UmFuZG9tQm9vbGVhbigpIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkgPCAwLjU7XG59XG5cbmNvbnN0IEdhbWVCb2FyZCA9ICgpID0+IHtcbiAgY29uc3QgYm9hcmQgPSBbXTtcblxuICBmdW5jdGlvbiBpbml0aWFsaXplKGJvYXJkU2l6ZSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmRTaXplOyBpKyspIHtcbiAgICAgIGNvbnN0IGZpZWxkID0ge1xuICAgICAgICBvY2N1cGllZDogbnVsbCxcbiAgICAgICAgdmlzaXRlZDogZmFsc2UsXG4gICAgICB9O1xuICAgICAgYm9hcmQucHVzaChmaWVsZCk7XG4gICAgfVxuICB9XG5cbiAgaW5pdGlhbGl6ZShzaXplKTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAodHlwZSwgY29vcmRpbmF0ZXMsIGhvcml6b250YWwgPSBnZXRSYW5kb21Cb29sZWFuKCkpID0+IHtcbiAgICBjb25zdCBzaGlwID0gdHlwZXNbdHlwZV07XG4gICAgY29uc3Qgc2hpcFNpemUgPSBzaGlwLmdldFNpemUoKTtcbiAgICBjb25zdCBpc0hvcml6b250YWwgPSBob3Jpem9udGFsO1xuXG4gICAgY29uc3QgaG9yaXpvbnRhbEJvcmRlciA9IFswLCAxMCwgMjAsIDMwLCA0MCwgNTAsIDYwLCA3MCwgODAsIDkwLCAxMDBdO1xuICAgIGNvbnN0IHZlcnRpY2FsQm9yZGVyID0gWzEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOV07XG5cbiAgICBmdW5jdGlvbiBjaGVja0lmQ29vcmRpbmF0ZXNWYWxpZCgpIHtcbiAgICAgIGlmIChpc0hvcml6b250YWwgPT09IHRydWUpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwU2l6ZTsgaSsrKSB7XG4gICAgICAgICAgaWYgKGhvcml6b250YWxCb3JkZXIuaW5jbHVkZXMoY29vcmRpbmF0ZXMgKyBpKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemU7IGkrKykge1xuICAgICAgICAgIGlmIChjb29yZGluYXRlcyArIGkgPj0gMCAmJiBjb29yZGluYXRlcyArIGkgPCBzaXplKVxuICAgICAgICAgICAgaWYgKGJvYXJkW2Nvb3JkaW5hdGVzICsgaV0ub2NjdXBpZWQgIT09IG51bGwpIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChpc0hvcml6b250YWwgPT09IGZhbHNlKSB7XG4gICAgICAgIGxldCB2ZXJ0aWNhbEZpZWxkcyA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemU7IGkrKykge1xuICAgICAgICAgIGlmICh2ZXJ0aWNhbEJvcmRlci5pbmNsdWRlcyhjb29yZGluYXRlcyArIHZlcnRpY2FsRmllbGRzKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB2ZXJ0aWNhbEZpZWxkcyArPSAxMDtcbiAgICAgICAgfVxuICAgICAgICB2ZXJ0aWNhbEZpZWxkcyA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemU7IGkrKykge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzICsgdmVydGljYWxGaWVsZHMgPj0gMCAmJlxuICAgICAgICAgICAgY29vcmRpbmF0ZXMgKyB2ZXJ0aWNhbEZpZWxkcyA8IHNpemVcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGlmIChib2FyZFtjb29yZGluYXRlcyArIHZlcnRpY2FsRmllbGRzXS5vY2N1cGllZCAhPT0gbnVsbClcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgdmVydGljYWxGaWVsZHMgKz0gMTA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoaXNIb3Jpem9udGFsID09PSB0cnVlICYmIGNoZWNrSWZDb29yZGluYXRlc1ZhbGlkKCkgPT09IHRydWUpIHtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IFtcbiAgICAgICAgLy8gcmlnaHQgc2lkZVxuICAgICAgICBjb29yZGluYXRlcyArIHNoaXBTaXplIC0gMTAsXG4gICAgICAgIGNvb3JkaW5hdGVzICsgc2hpcFNpemUgKyAxMCxcbiAgICAgICAgY29vcmRpbmF0ZXMgKyBzaGlwU2l6ZSxcbiAgICAgICAgLy8gbGVmdCBzaWRlXG4gICAgICAgIGNvb3JkaW5hdGVzIC0gMTEsXG4gICAgICAgIGNvb3JkaW5hdGVzIC0gMSxcbiAgICAgICAgY29vcmRpbmF0ZXMgKyA5LFxuICAgICAgXTtcbiAgICAgIGJ1ZmZlci5mb3JFYWNoKChmaWVsZCwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKGZpZWxkID49IDAgJiYgZmllbGQgPCAxMDApIHtcbiAgICAgICAgICBpZiAoaW5kZXggPCAzICYmICFob3Jpem9udGFsQm9yZGVyLmluY2x1ZGVzKGZpZWxkKSlcbiAgICAgICAgICAgIGJvYXJkW2ZpZWxkXS5vY2N1cGllZCA9IFwiYmxvY2tlZFwiO1xuICAgICAgICAgIGlmIChpbmRleCA+IDIgJiYgIWhvcml6b250YWxCb3JkZXIubWFwKCh4KSA9PiB4IC0gMSkuaW5jbHVkZXMoZmllbGQpKVxuICAgICAgICAgICAgYm9hcmRbZmllbGRdLm9jY3VwaWVkID0gXCJibG9ja2VkXCI7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwU2l6ZTsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlckZpZWxkcyA9IFtjb29yZGluYXRlcyArIGkgKyAxMCwgY29vcmRpbmF0ZXMgKyBpIC0gMTBdO1xuICAgICAgICBib2FyZFtjb29yZGluYXRlcyArIGldLm9jY3VwaWVkID0gc2hpcDtcbiAgICAgICAgYnVmZmVyRmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgaWYgKGZpZWxkID49IDAgJiYgZmllbGQgPCAxMDApIGJvYXJkW2ZpZWxkXS5vY2N1cGllZCA9IFwiYmxvY2tlZFwiO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoaXNIb3Jpem9udGFsID09PSBmYWxzZSAmJiBjaGVja0lmQ29vcmRpbmF0ZXNWYWxpZCgpID09PSB0cnVlKSB7XG4gICAgICBjb25zdCBidWZmZXIgPSBbXG4gICAgICAgIC8vIHJpZ2h0IHNpZGVcbiAgICAgICAgY29vcmRpbmF0ZXMgLSA5LFxuICAgICAgICBjb29yZGluYXRlcyArIHNoaXBTaXplICogMTAgKyAxLFxuICAgICAgICAvLyBsZWZ0IHNpZGVcbiAgICAgICAgY29vcmRpbmF0ZXMgLSAxMSxcbiAgICAgICAgY29vcmRpbmF0ZXMgKyBzaGlwU2l6ZSAqIDEwIC0gMSxcbiAgICAgICAgLy8gdXAgYW5kIGRvd25cbiAgICAgICAgY29vcmRpbmF0ZXMgLSAxMCxcbiAgICAgICAgY29vcmRpbmF0ZXMgKyBzaGlwU2l6ZSAqIDEwLFxuICAgICAgXTtcbiAgICAgIGJ1ZmZlci5mb3JFYWNoKChmaWVsZCwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKGZpZWxkID49IDAgJiYgZmllbGQgPCAxMDApIHtcbiAgICAgICAgICBpZiAoaW5kZXggPCAyICYmICFob3Jpem9udGFsQm9yZGVyLmluY2x1ZGVzKGZpZWxkKSlcbiAgICAgICAgICAgIGJvYXJkW2ZpZWxkXS5vY2N1cGllZCA9IFwiYmxvY2tlZFwiO1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGluZGV4ID4gMSAmJlxuICAgICAgICAgICAgaW5kZXggPCA0ICYmXG4gICAgICAgICAgICAhaG9yaXpvbnRhbEJvcmRlci5tYXAoKHgpID0+IHggLSAxKS5pbmNsdWRlcyhmaWVsZClcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGJvYXJkW2ZpZWxkXS5vY2N1cGllZCA9IFwiYmxvY2tlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaW5kZXggPiAzKSB7XG4gICAgICAgICAgICBib2FyZFtmaWVsZF0ub2NjdXBpZWQgPSBcImJsb2NrZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgbGV0IHZlcnRpY2FsRmllbGRzID0gMDtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFNpemU7IGkrKykge1xuICAgICAgICBjb25zdCBidWZmZXJGaWVsZHMgPSBbXG4gICAgICAgICAgY29vcmRpbmF0ZXMgKyB2ZXJ0aWNhbEZpZWxkcyArIDEsXG4gICAgICAgICAgY29vcmRpbmF0ZXMgKyB2ZXJ0aWNhbEZpZWxkcyAtIDEsXG4gICAgICAgIF07XG4gICAgICAgIGJvYXJkW2Nvb3JkaW5hdGVzICsgdmVydGljYWxGaWVsZHNdLm9jY3VwaWVkID0gc2hpcDtcbiAgICAgICAgYnVmZmVyRmllbGRzLmZvckVhY2goKGZpZWxkLCBpbmRleCkgPT4ge1xuICAgICAgICAgIGlmIChmaWVsZCA+PSAwICYmIGZpZWxkIDwgMTAwKSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IDAgJiYgIWhvcml6b250YWxCb3JkZXIuaW5jbHVkZXMoZmllbGQpKVxuICAgICAgICAgICAgICBib2FyZFtmaWVsZF0ub2NjdXBpZWQgPSBcImJsb2NrZWRcIjtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgaW5kZXggPT09IDEgJiZcbiAgICAgICAgICAgICAgIWhvcml6b250YWxCb3JkZXIubWFwKCh4KSA9PiB4IC0gMSkuaW5jbHVkZXMoZmllbGQpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgIGJvYXJkW2ZpZWxkXS5vY2N1cGllZCA9IFwiYmxvY2tlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHZlcnRpY2FsRmllbGRzICs9IDEwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgaWYgKGJvYXJkW2Nvb3JkaW5hdGVzXS52aXNpdGVkID09PSB0cnVlKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkZpZWxkIHdhcyBhbHJlYWR5IHVzZWRcIik7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGJvYXJkW2Nvb3JkaW5hdGVzXS5vY2N1cGllZCAhPT0gbnVsbCAmJlxuICAgICAgYm9hcmRbY29vcmRpbmF0ZXNdLm9jY3VwaWVkICE9PSBcImJsb2NrZWRcIlxuICAgICkge1xuICAgICAgY29uc29sZS5sb2coXCJTaGlwIHdhcyBzdHJpa2VkXCIpO1xuICAgICAgYm9hcmRbY29vcmRpbmF0ZXNdLm9jY3VwaWVkLmhpdCgpO1xuICAgICAgYm9hcmRbY29vcmRpbmF0ZXNdLnZpc2l0ZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBib2FyZFtjb29yZGluYXRlc10udmlzaXRlZCA9IHRydWU7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGFyZUFsbFN1bmsgPSAoKSA9PiB7XG4gICAgbGV0IGFyZVN1bmsgPSB0cnVlO1xuICAgIGJvYXJkLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGZpZWxkLm9jY3VwaWVkICE9PSBudWxsICYmXG4gICAgICAgIGZpZWxkLm9jY3VwaWVkICE9PSBcImJsb2NrZWRcIiAmJlxuICAgICAgICBmaWVsZC5vY2N1cGllZC5pc1N1bmsoKSA9PT0gZmFsc2VcbiAgICAgICkge1xuICAgICAgICBhcmVTdW5rID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGFyZVN1bms7XG4gIH07XG5cbiAgcmV0dXJuIHsgYm9hcmQsIHBsYWNlU2hpcCwgcmVjZWl2ZUF0dGFjaywgYXJlQWxsU3VuayB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgR2FtZUJvYXJkO1xuZXhwb3J0IHsgc2l6ZSB9O1xuIiwiaW1wb3J0IFBsYXllciBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCBHYW1lQm9hcmQsIHsgc2l6ZSB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuXG5jb25zdCBwbGF5ZXIgPSBQbGF5ZXIoXCJQbGF5ZXJcIik7XG5jb25zdCBvcHBvbmVudCA9IFBsYXllcihcIkNvbXB1dGVyXCIpO1xuY29uc3QgcGxheWVyQm9hcmQgPSBHYW1lQm9hcmQoKTtcbmNvbnN0IG9wcG9uZW50Qm9hcmQgPSBHYW1lQm9hcmQoKTtcblxuY29uc3QgYm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWVib2FyZHNcIik7XG5cbmZ1bmN0aW9uIHJhbmRvbWx5UGxhY2VTaGlwcyhwbGF5ZXIsIGJvYXJkKSB7XG4gIGNvbnN0IHBsYXllclNoaXBzID0gcGxheWVyLnNoaXBzO1xuICBjb25zdCBzaGlwc0NvdW50ID0gcGxheWVyLnNoaXBzLmxlbmd0aDtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBzQ291bnQ7IGkrKykge1xuICAgIGNvbnN0IHNoaXBOYW1lID0gcGxheWVyU2hpcHMucG9wKCk7XG4gICAgY29uc3QgcmFuZG9tQ29vcmRpbmF0ZXMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaXplKTtcbiAgICBjb25zdCBwbGFjZVNoaXAgPSBib2FyZC5wbGFjZVNoaXAoc2hpcE5hbWUsIHJhbmRvbUNvb3JkaW5hdGVzKTtcbiAgICBpZiAocGxhY2VTaGlwID09PSBmYWxzZSkge1xuICAgICAgcGxheWVyU2hpcHMucHVzaChzaGlwTmFtZSk7XG4gICAgICBpIC09IDE7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGFkZENvbnRyb2xzKCkge1xuICBjb25zdCBvcHBvbmVudEJvYXJkRE9NID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIltkYXRhLXBsYXllcj0nQ29tcHV0ZXInXCIpO1xuXG4gIG9wcG9uZW50Qm9hcmRET00uY2hpbGROb2Rlcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBtYWtlVHVybihmaWVsZC5kYXRhc2V0LmZpZWxkKTtcbiAgICAgIGNvbnNvbGUubG9nKGZpZWxkLmRhdGFzZXQuZmllbGQpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlQm9hcmRzKCkge1xuICBzaG93R2FtZUJvYXJkKHBsYXllckJvYXJkLCBwbGF5ZXIpO1xuICBzaG93R2FtZUJvYXJkKG9wcG9uZW50Qm9hcmQsIG9wcG9uZW50KTtcbiAgYWRkQ29udHJvbHMoKTtcbn1cblxuZnVuY3Rpb24gaW5pdGlhbGl6ZUdhbWUoKSB7XG4gIHJhbmRvbWx5UGxhY2VTaGlwcyhwbGF5ZXIsIHBsYXllckJvYXJkKTtcbiAgcmFuZG9tbHlQbGFjZVNoaXBzKG9wcG9uZW50LCBvcHBvbmVudEJvYXJkKTtcbn1cblxuZnVuY3Rpb24gbWFrZVR1cm4oY29vcmRpbmF0ZXMpIHtcbiAgb3Bwb25lbnRCb2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGVzKTtcbiAgY2xlYXJCb2FyZHMoKTtcbiAgdXBkYXRlQm9hcmRzKCk7XG59XG4vLyAqXG5mdW5jdGlvbiBjbGVhckJvYXJkcygpIHtcbiAgYm9hcmRDb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcbn1cblxuZnVuY3Rpb24gc2hvd0dhbWVCb2FyZChib2FyZCwgcGxheWVyKSB7XG4gIGNvbnN0IG5ld0JvYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICBuZXdCb2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJncmlkXCI7XG4gIG5ld0JvYXJkLnN0eWxlLmdyaWRUZW1wbGF0ZUNvbHVtbnMgPSBgcmVwZWF0KCR7TWF0aC5zcXJ0KHNpemUpfSwgMWZyKWA7XG4gIG5ld0JvYXJkLmRhdGFzZXQucGxheWVyID0gcGxheWVyLm5hbWU7XG5cbiAgYm9hcmQuYm9hcmQuZm9yRWFjaCgoZmllbGQsIGluZGV4KSA9PiB7XG4gICAgY29uc3QgZHJhd0ZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBkcmF3RmllbGQuY2xhc3NMaXN0LmFkZChcImZpZWxkXCIpO1xuICAgIGRyYXdGaWVsZC5kYXRhc2V0LmZpZWxkID0gaW5kZXg7XG4gICAgaWYgKFxuICAgICAgKGZpZWxkLm9jY3VwaWVkID09PSBudWxsICYmIGZpZWxkLnZpc2l0ZWQgPT09IHRydWUpIHx8XG4gICAgICAoZmllbGQub2NjdXBpZWQgPT09IFwiYmxvY2tlZFwiICYmIGZpZWxkLnZpc2l0ZWQgPT09IHRydWUpXG4gICAgKSB7XG4gICAgICBkcmF3RmllbGQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJsaWdodGdyYXlcIjtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgKGZpZWxkLm9jY3VwaWVkICE9PSBudWxsICYmIGZpZWxkLnZpc2l0ZWQgPT09IHRydWUpIHx8XG4gICAgICAoZmllbGQub2NjdXBpZWQgIT09IFwiYmxvY2tlZFwiICYmIGZpZWxkLnZpc2l0ZWQgPT09IHRydWUpXG4gICAgKSB7XG4gICAgICBkcmF3RmllbGQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLm9jY3VwaWVkICE9PSBudWxsICYmIGZpZWxkLm9jY3VwaWVkICE9PSBcImJsb2NrZWRcIikge1xuICAgICAgZHJhd0ZpZWxkLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgfVxuXG4gICAgbmV3Qm9hcmQuYXBwZW5kQ2hpbGQoZHJhd0ZpZWxkKTtcbiAgfSk7XG5cbiAgYm9hcmRDb250YWluZXIuYXBwZW5kQ2hpbGQobmV3Qm9hcmQpO1xufVxuXG5leHBvcnQgeyBzaG93R2FtZUJvYXJkLCBjbGVhckJvYXJkcywgaW5pdGlhbGl6ZUdhbWUsIHVwZGF0ZUJvYXJkcyB9O1xuIiwiaW1wb3J0IHsgaW5pdGlhbGl6ZUdhbWUsIHVwZGF0ZUJvYXJkcyB9IGZyb20gXCIuL21vZHVsZXMvaW50ZXJmYWNlXCI7XG5cbmluaXRpYWxpemVHYW1lKCk7XG51cGRhdGVCb2FyZHMoKTtcbiJdLCJuYW1lcyI6WyJuYW1lIiwidHVybiIsInNoaXBzIiwic2l6ZSIsImhlYWx0aCIsInN1bmsiLCJnZXRIZWFsdGgiLCJnZXRTaXplIiwiaGl0IiwiaXNTdW5rIiwiQ2FycmllciIsIkJhdHRsZXNoaXAiLCJDcnVpc2VyIiwiU3VibWFyaW5lIiwiRGVzdHJveWVyIiwiYm9hcmQiLCJib2FyZFNpemUiLCJpIiwiZmllbGQiLCJvY2N1cGllZCIsInZpc2l0ZWQiLCJwdXNoIiwiaW5pdGlhbGl6ZSIsInBsYWNlU2hpcCIsInR5cGUiLCJjb29yZGluYXRlcyIsImhvcml6b250YWwiLCJNYXRoIiwicmFuZG9tIiwiZ2V0UmFuZG9tQm9vbGVhbiIsInNoaXAiLCJzaGlwU2l6ZSIsImlzSG9yaXpvbnRhbCIsImhvcml6b250YWxCb3JkZXIiLCJ2ZXJ0aWNhbEJvcmRlciIsImNoZWNrSWZDb29yZGluYXRlc1ZhbGlkIiwiaW5jbHVkZXMiLCJ2ZXJ0aWNhbEZpZWxkcyIsImZvckVhY2giLCJpbmRleCIsIm1hcCIsIngiLCJidWZmZXJGaWVsZHMiLCJyZWNlaXZlQXR0YWNrIiwiY29uc29sZSIsImxvZyIsImFyZUFsbFN1bmsiLCJhcmVTdW5rIiwib3Bwb25lbnQiLCJwbGF5ZXJCb2FyZCIsIm9wcG9uZW50Qm9hcmQiLCJib2FyZENvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInJhbmRvbWx5UGxhY2VTaGlwcyIsInBsYXllciIsInBsYXllclNoaXBzIiwic2hpcHNDb3VudCIsImxlbmd0aCIsInNoaXBOYW1lIiwicG9wIiwicmFuZG9tQ29vcmRpbmF0ZXMiLCJmbG9vciIsInVwZGF0ZUJvYXJkcyIsInNob3dHYW1lQm9hcmQiLCJjaGlsZE5vZGVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRhdGFzZXQiLCJpbm5lckhUTUwiLCJuZXdCb2FyZCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImRpc3BsYXkiLCJncmlkVGVtcGxhdGVDb2x1bW5zIiwic3FydCIsImRyYXdGaWVsZCIsImNsYXNzTGlzdCIsImFkZCIsImJhY2tncm91bmRDb2xvciIsImFwcGVuZENoaWxkIl0sInNvdXJjZVJvb3QiOiIifQ==